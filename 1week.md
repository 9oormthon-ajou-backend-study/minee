## 1장 JPA 소개 
### SQL을 직접 사용할 때에 발생하는 문제점
1. 반복 작업
- 자바의 객체는 관계형 DB에 바로 저장할 수 없다.
- 객체가 들고 있는 정보를 테이블에 저장하기 위해서는 필드를 하나씩 뜯어서 SQL문을 작성하고... 할 필요가 있다.
- 테이블에서 꺼낼 때도 칼럼 하나씩 꺼내서 객체 필드에 넣어줘야 한다.
  
2. SQL에 의존적임
- 객체의 사양을 변경하거나 객체끼리의 관계가 변경될 때, SQL문을 모두 변경해야 한다.
- 어떤 클래스의 어떤 메서드가 어떤 SQL문을 실행하는지 일일히 확인하고 사용해야 한다.

__JPA는 이런 문제들을 휘리릭 뿅 하고 해결해준다.__
- 개발자는 SQL을 작성하지 않는다. persist, find와 같은 메서드를 사용하면 된다. (적절한 SQL문을 JPA가 알아서 작성해 준다)
- 객체를 테이블에 저장하기 위해 여러 정보를 미리 설정해 두는데 이것을 매핑정보라고 한다. 

### 객체 - 데이터베이스의 패러다임의 불일치 때문에 발생하는 문제 
1. 테이블에는 상속이라는 개념이 없다.
- 무언가를 상속한 객체를 테이블에 저장하려면, 이 객체에서 부모와 자식을 분리해 따로따로 INSERT 할 필요가 있다. (코드량이 무쟈게 많아질 수 있다.)
- 만약 이 객체를 컬렉션에 저장해야 한다면: 큰 고민 없이 컬렉션에 add 해서 넣으면 된다.
- (해결) JPA를 사용하면 persist를 사용해 간단히 저장할 수 있다.
  - JPA는 부모와 자식을 서로 다른 테이블에 나누어 저장한다.
  - 저장한 객체를 불러올 때에는 두 테이블을 JOIN해서 필요한 데이터를 꺼내온다.

2. 연관관계: 객체의 참조 vs 테이블의 외래키
- 객체는 참조 방향으로만 조회할 수  있다. (A에 B 필드가 있을 때만 A.getB() 할 수 있음, B.getA()는 불가)
- 반면에 테이블은 외래키 하나로 양방향의 조회가 가능하다.
- 테이블은 참조 필드가 필요 없고 객체는 외래키가 필요 없다. 중간에서 개발자가 서로를 변환해주는 역할을 해야 한다.
  - 저장할 때: 객체에 참조 필드를 만들어 두고, 테이블에 저장할 때는 참조의 id(외래키 값)를 꺼내서 저장한다.
  - 조회할 때: 외래키 값을 참조로 변환해서 객체에 보관하면 된다.
  - 객체를 테이블에 저장하려고 해서 생기는 비용. 컬렉션에 넣으면 이런 짓 안 해도 된다.
- (해결)
  - 객체에 참조 필드를 만들고 persist로 저장하면 된다.
  - JPA가 참조를 외래 키로 변환해서 적절한 SQL문을 써준다.
  - 조회할 때 외래키를 참조로 변환하는 일도 JPA가 해준다.

3. 객체 그래프 탐색
- 객체가 연관돼있는 다른 객체들을 탐색하는 것. A.getB().getC().getD(). ...
  - 객체가 연결돼 있다면 (참조하고 있다면) 자유롭게 탐색할 수 있어야 한다.
- SQL을 직접 다루면 처음 실행하는 SQL에 따라 객체 그래프를 어디까지 탐색할 수 있는지가 정해진다.
  - SELECT 한 범위에 의해 탐색 범위가 제약됨
  - SELECT 하면 연관된 모든 객체가 끌려나오는 게 아니라 where 절 아래의 내용으로부터만 끌고 나오기 때문에
  - 개발하는 중에 어디까지 연결돼 있는지 확인하기 위해 SQL문을 직접 뜯어봐야 할 필요가 생긴다 (!)
- (해결) JPA는 실제 객체를 사용하는 시점까지 데이터베이스 조회를 미룬다. 이것을 지연 로딩이라고 한다.
  - 실제 객체를 사용하는 시점에 필요한 참조를 파악해 적절한 SQL문을 작성해 가져온다.

4. 비교 결과 불일치
- 동일성 비교 (==, identity) 동등성 비교 (equals(), equality)
 - 동일성 비교는 객체 인스턴스의 주소 값을 비교한다.
 - 동등성 비교는 equals() 메소드를 사용해 객체 내부의 값을 비교한다.
- 데이터베이스의 row는 id 값으로 같은지 다른지 판단한다. id가 같은 인스턴스를 여러 개 만들 수 있다.
  - 데이터베이스 입장에서는 두 인스턴스가 동일하지만 객체 입장에서는 동일하지 않게 된다.
- (해결) JPA는 같은 트랜잭션일 때 같은 객체가 조회되는 것을 보장한다.
  - 한 트랜잭션 안에서 find한 인스턴스 값은 서로 같다.

### JPA란 무엇인가? 
- 자바 진영의 ORM (Orient-Relational Mapping) 표준 기술
- 객체를 CRUD 할 때 SQL을 구체적으로 고려하지 않아도 된다. 객체는 객체처럼, 테이블은 테이블처럼 설계하면 된다.
- 패러다임이 불일치해 발생하는 문제도 JPA가 해결할 수 있다.

